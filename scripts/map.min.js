/**
 * author Alagukannan Alagappan
 * created 11/4/2013
 * version 1.1
 */
var map;var ODIData;var TESTData;var ODIMarkers=[];var TESTMarkers=[];var ODITemplate;var TESTTemplate;var markerCluster;var mcOptions={gridSize:20,maxZoom:12};var infowindow;var MatchType={ODI:{icon:"/images/white_ball_icon.png",data:"/data/sachinODI.min.js"},TEST:{icon:"/images/red_ball_icon.png",data:"/data/sachinTest.min.js"}};function createMarker(latlng,text,matchtype){var marker=new google.maps.Marker({position:latlng,animation:google.maps.Animation.BOUNCE,map:map,icon:MatchType[matchtype].icon});var allMarkers=markerCluster.getMarkers();var temptext='';if(allMarkers.length!=0){for(i=0;i<allMarkers.length;i++){var existingMarker=allMarkers[i];var pos=existingMarker.getPosition();if(latlng.equals(pos)){text=text+","+i+":"+eval(matchtype+"Data")[i]["Id"];}}}
google.maps.event.addListener(marker,'click',function(){infowindow.close();var infoContentHTML=getInfoContent(text,matchtype);infowindow.setContent(infoContentHTML);infowindow.open(map,marker);});markerCluster.addMarker(marker);return marker;}
function getInfoContent(str,matchtype){var liString='';var GroundName;var matchArray=str.split(",");var content='';var firstArray=matchArray.shift();matchArray.push(firstArray);$.each(matchArray,function(index,value){var tempArray=value.split(":");var tempObj={position:tempArray[0],ID:parseInt(tempArray[1])};var MatchObject=eval(matchtype+"Data")[tempObj.position];if(MatchObject&&MatchObject.Id===tempObj.ID){if(!GroundName){GroundName="<a href='"+MatchObject["GroundURL"]+"' target='_blank'><h3>"+MatchObject["FullGroundName"]+"</h3></a>";}
switch(matchtype){case"ODI":content="<li><a class='detailModal' href='"+MatchObject["MatchURL"]+"' title='More Info'  target='_blank'id="+matchtype+"_"+tempObj.position+"_"+tempObj.ID+">"+MatchObject["DisplayRuns"]+"</a> Vs <strong>"+MatchObject["Opposition"]+"</strong> On "+MatchObject["StartDate"]+"</li>";break;case"TEST":content="<li><a class='detailModal' href='"+MatchObject["MatchURL"]+"' title='More Info'  target='_blank'id="+matchtype+"_"+tempObj.position+"_"+tempObj.ID+">Vs "+MatchObject["Opposition"]+"</a> On "+MatchObject["StartDate"]+"<ul><li>First Innings: <strong>"+MatchObject["DisplayBat1"]+"</strong></li><li>Second Innings: <strong>"+MatchObject["DisplayBat2"]+"</strong></li></ul></li>";break;default:break;}
liString=liString+content;}});if(GroundName&&liString)
return GroundName+"<ol>"+liString+"</ol>";}
$(document).ready(function(){google.maps.visualRefresh=true;var mapOptions={center:new google.maps.LatLng(13.0628853,80.2791712),zoom:3,mapTypeId:google.maps.MapTypeId.HYBRID};map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions);infowindow=new google.maps.InfoWindow();ODITemplate=Mustache.compile($('#ODI_Template').html());TESTTemplate=Mustache.compile($('#Test_Template').html());$.getJSON(MatchType.ODI.data,function(data){ODIData=data;ToggleODI();});$.getJSON(MatchType.TEST.data,function(data){TESTData=data;});$("form input:radio[name='matchtype']").change(function(){if(markerCluster){markerCluster.clearMarkers();}
switch($(this).val()){case"ODI":TESTMarkers=[];ToggleODI();break;case"Test":ODIMarkers=[];ToggleTest();break;}});$("body").on("click",".detailModal",function(event){var splitArray=this.id.split("_");if(splitArray.length==3)
{event.preventDefault();var MatchObject=eval(splitArray[0]+"Data")[splitArray[1]];var matchHTML=eval(splitArray[0]+"Template")(MatchObject);$.colorbox({html:matchHTML});}});var adUnitDiv=document.createElement('div');var adUnitOptions={format:google.maps.adsense.AdFormat.BANNER,position:google.maps.ControlPosition.BOTTOM_LEFT,backgroundColor:'#c4d4f3',borderColor:'#e5ecf9',titleColor:'#0000cc',textColor:'#000000',urlColor:'#009900',map:map,visible:true,publisherId:'pub-0276509726748403'}
adUnit=new google.maps.adsense.AdUnit(adUnitDiv,adUnitOptions);});function ToggleODI(){markerCluster=new MarkerClusterer(map,ODIMarkers,mcOptions);for(var i=0;i<ODIData.length;i++){var position=new google.maps.LatLng(ODIData[i].Latitude,ODIData[i].Longitude);ODIMarkers.push(createMarker(position,i+":"+ODIData[i]["Id"],"ODI"));}}
function ToggleTest(){markerCluster=new MarkerClusterer(map,TESTMarkers,mcOptions);for(var i=0;i<TESTData.length;i++){var position=new google.maps.LatLng(TESTData[i].Latitude,TESTData[i].Longtitude);TESTMarkers.push(createMarker(position,i+":"+TESTData[i]["Id"],"TEST"));}}